2주차 학습정리<br/>
===============

### Unity & AR
<br/>

> #### 학습 내용 <br/>
* 캡슐 잠금 기능 추가 (캡슐의 잠금 설정 여부와 만료일에 따라 캡슐 클릭시 다른 팝업창이 출력)
* 안드로이드 스튜디오와 유니티 통신 (앱에서 유니티 실행시 로그인한 회원의 아이디를 유니티 프로그램으로 전송)
* 사용자의 방향을 측정하여 캡슐의 위치를 재렌더링(사용자가 이동함에 따라 각도를 측정하여 캡슐에 적용) <br/><br/>


> #### 캡슐 잠금 기능<br/>
* 서버에서 받아온 캡슐의 정보(status_lock, key_count)를 이용하여 캡슐 렌더링시 생성 오브젝트의 이름에 차이를 두었다. 캡슐을 클릭하는 과정에서 이를
구분하여 각각의 경우에 따라 다른 팝업창을 출력시킨다.
* 만료일이 남은 잠금 캡슐의 경우 클릭시 캡슐의 진동 효과와 함께 d-day를 표시하는 팝업창을 출력, 만료일이 지난 잠금 캡슐의 경우 클릭시 적용되어있는 키를
표시하는 팝업창을 출력할 예정이다.
* 위에서 언급한 키의 경우 과반수 이상이 적용된 경우 잠금 캡슐의 기능이 활성화되며 멤버(캡슐을 같이 묻은 사용자)들이 이를 열람할 수 있다. <br/><br/>


<테스트 이미지>
![main](https://user-images.githubusercontent.com/48250370/88484140-9553b300-cfa7-11ea-94d8-d279a3393910.PNG)<br/>
빨간색의 경우 기한이 남은 잠금 캡슐 / 파란색의 경우 기한이 끝난 잠금 캡슐

![index](https://user-images.githubusercontent.com/48250370/88484143-971d7680-cfa7-11ea-8f97-ce6e9e0e14bc.PNG)<br/>
캡슐 번호 + "L"의 경우 기한이 남은 잠금 캡슐을 의미 / 캡슐 번호 + "O"의 경우 기한이 만료된 잠금 캡슐을 의미

![log](https://user-images.githubusercontent.com/48250370/88484142-9684e000-cfa7-11ea-80d3-b0f486fd5ed7.PNG)<br/>
빨간색 캡슐을 클릭시 "Locked" 출력 / 파란색 캡슐을 클릭시 "key_Count" 출력<br/><br/>

> #### 안드로이드 스튜디오와 유니티 통신<br/>
* 앱에서 유니티를 실행시 로그인한 사용자의 정보를 유니티로 전송한다. 전송한 user_id or nick_name은 임시 캡슐 생성시 사용된다.
* 유니티 프로그램 실행 시간을 고려하여 전송에 딜레이를 걸어 유니티 실행후 데이터가 전송되도록 조정하였다. <br/><br/>

![send](https://user-images.githubusercontent.com/48250370/88484334-d7c9bf80-cfa8-11ea-931d-b0df56a241f6.png)<br/>
상단은 유니티 실행후 전송된 데이터가 출력된 화면 / 하단은 안드로이드 스튜디오에서 유니티로 보낼 데이터를 선언한 코드 부분<br/><br/>


> #### 사용자의 방향에 따른 캡슐 위치 조정<br/>
* 유니티 프로그램은 실행하는 순간에 향해있던 방향을 기준으로 캡슐을 렌더링하게 된다. 이 경우 북쪽 방향과 사용자의 스마트폰이 향한 방향과의 차이로 캡슐은
실제 위치와 다른 곳에 렌더링된다. 따라서 이를 조정할 필요성이 있다.
* 기존 유니티에서 제공하는 gyro와 compass 사용시 그 측정값의 오차가 너무 심하여 다른 방안을 모색하였다.
* 현재 적용한 기능은 사용자가 이동함에 따라 그 이동 거리를 측정하여 캡슐을 재랜더링하는 방식을 취하고 있다. 이 과정에서 삼각형의 세 변의 길이 공식을 이용
하였으며 방법은 다음과 같다.
1. 사용자의 초기 gps 좌표(gps1)를 측정
2. 초기 gps 좌표를 기준으로 북쪽으로 일정 거리에 있는 gps 좌표(gps2)를 측정
3. 사용자가 일정 거리를 이동하면 변화된 gps 좌표를 측정(gps3)
4. 측정한 세 gps 좌표를 꼭지점으로 하는 삼각형의 각 변의 길이 측정
5. 삼각형의 세 변의 길이 공식을 이용하여 gps1,gps2 와 gps1,gps3 사이의 각도를 측정
6. 측정값(사용자가 향하고 있는 방향과 북쪽 방향과의 차이각)을 캡슐에 적용하여 재렌더링 
* gps 좌표의 부정확성으로 아직 오차가 발생하여 추가적인 보완이 필요 <br/><br/>

![rendering](https://user-images.githubusercontent.com/48250370/88484582-8f130600-cfaa-11ea-87ff-197b6b1a638d.png)<br/>


> #### commit<br/>
![image](https://user-images.githubusercontent.com/48250370/88484662-26785900-cfab-11ea-8c99-a20dadd34787.png)<br/>
https://github.com/capstone-project-team11/capstone_project/tree/master/documents/%EA%B0%9C%EC%9D%B8%EB%B3%84%EC%9E%90%EB%A3%8C/%EA%B9%80%ED%83%9C%EC%99%84/capsuletime/%EB%B0%A9%ED%95%992%EC%A3%BC%EC%B0%A8
